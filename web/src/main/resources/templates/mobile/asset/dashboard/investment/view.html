<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>HKMA - 投資儀表板</title>
        <link rel="icon" href="/home/icon/favicon.png" />
        
        <!-- android -->
        <link rel="shortcut icon" href="/home/icon/favicon.png" />
        
        <!-- ios -->
        <link rel="apple-touch-icon" href="/home/icon/asset_ios.png" />
        <link rel="apple-touch-icon" href="/home/icon/asset_ios_180.png" sizes="180x180" />
        <link rel="apple-touch-icon" href="/home/icon/asset_ios_120.png" sizes="120x120" />
        <link rel="apple-touch-icon" href="/home/icon/asset_ios_114.png" sizes="114x114" />
        
        <!-- jQuery -->
		<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
		
		<!-- jQuery Mobile --> 
		<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
		<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
		
		<!-- HKMA -->
		<link rel="stylesheet" href="/home/css/hkma.css" />
		
		<meta name="_csrf" th:content="${_csrf.token}" />
		<meta name="_csrf_header" th:content="${_csrf.headerName}" />
        
        <style>
            /*改掉jQuery自動產生--*/
            /*
            .ui-page-theme-a.ui-page.ui-page-active{
                min-height: 0px !important;
            }
            */
            .highcharts-figure{
                margin: 0px;
            }
            .ui-panel-wrapper{
              	padding: 5px;
            }
            .ui-panel-wrapper .box{
                padding: 5px;
            }
            .ui-panel-wrapper .box .box-head{
                padding: 5px;
                font-size: 21px;
                height: 30px;
            }
            .ui-panel-wrapper .box>.box-inside{
                background-color: white;
            }
            
            .ui-panel-wrapper .box .text{
                text-align: center;
            }
            .ui-panel-wrapper .box .table{
                padding: 10px;
            }
            .ui-panel-wrapper .box .table>.table-inside{
                overflow: hidden;
                -webkit-box-shadow: 0px 1px 3px rgb(0 0 0 / 15%);
            }
            .ui-panel-wrapper .box .table>.table-inside>.table-body{
                overflow: auto;
            }
            .ui-panel-wrapper .box .table>.table-inside>.table-body::-webkit-scrollbar{
                display: none;
            }
            .ui-panel-wrapper .box .table .decimal{
                text-align: right;
            }
            .ui-panel-wrapper .box .table .plus{
                color: red;
            }
            .ui-panel-wrapper .box .table .minus{
                color: green;
            }
            
            @media (max-width:767px){
                .ui-panel-wrapper #assetDetail{
                     font-size: 13px;
                }
                .ui-panel-wrapper #stockInventory{
                     font-size: 12px;
                }
            }
            
            @media (min-width:768px){
                .ui-panel-wrapper .box1{
                    width: 100%;
                    float: left;
                }
                .ui-panel-wrapper .box2{
                    width: 50%;
                    float: left;
                }
                .ui-panel-wrapper .box3{
                    width: 33.33%;
                    float: left;
                }
            }
        </style>
	</head>
	<body>
		<!--Highcharts-->
        <script src="/home/highcharts/8.0.0/highcharts.js"></script>
        <!--<script src="../code/modules/exporting.js"></script>-->    <!--選項-->
        <!--<script src="../code/modules/export-data.js"></script>-->  <!--匯出資料-->
        <script src="/home/highcharts/8.0.0/modules/accessibility.js"></script>
        
        <div data-role="page" class="ui-page-theme-a">
            <div th:replace="mobile/include/header :: header"/>
            <div class="ui-panel-wrapper">
                <div id ="data"></div>
                <div class="row">
                    <div class="box3">
                        <div class="box">
                            <div class="box-inside" style="height: 110px;">
                                <div class="box-head"><text>現金</text></div>
                                <div class="box-body">
                                    <div class="text" id="deposit" style="font-size: 50px"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box3">
                        <div class="box">
                            <div class="box-inside" style="height: 110px;">
                                <div class="box-head"><text>股票</text></div>
                                <div class="box-body">
                                    <div class="text" id="stock" style="font-size: 50px"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box3">
                        <div class="box">
                            <div class="box-inside" style="height: 110px;">
                                <div class="box-head"><text>總額</text></div>
                                <div class="box-body">
                                    <div class="text" id="totalAmount" style="font-size: 50px"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="box3" >
                        <div class="box">
                            <div class="box-inside" style="height: 370px;">
                                <div class="box-head"><text>現金明細</text></div>
                                <div class="box-body">
                                    <div class="table">
                                        <div class="table-inside">
                                            <div class="table-body" style="height: 310px;">
                                                <table data-role="table" data-mode="" class="ui-shadow table-stripe" id="assetDetail">
                                                    <thead>
                                                        <tr>
                                                            <th>日期</th>
                                                            <th>摘要</th>
                                                            <th class="decimal">支出</th>
                                                            <th class="decimal">存入</th>
                                                            <th class="decimal">結餘</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box3">
                        <div class="box">
                            <div class="box-inside" style="height: 370px;">
                                <div class="box-head"><text>股票庫存</text></div>
                                <div class="box-body">
                                    <div class="table">
                                        <div class="table-inside">
                                            <div class="table-body" style="height: 310px;">
                                                <table data-role="table" data-mode="" class="ui-shadow table-stripe" id="stockInventory">
                                                    <thead>
                                                        <tr>
                                                            <th>代碼</th>
                                                            <th>名稱</th>
                                                            <th class="decimal">股數</th>
                                                            <th class="decimal">單價</th>
                                                            <th class="decimal">金額</th>
                                                            <th class="decimal">成本</th>
                                                            <th class="decimal">損益</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box3">
                        <div class="box">
                            <div class="box-inside" style="height: 370px;">
                                <div class="box-head"><text>資產</text></div>
                                <div class="box-body">
                                    <figure class="highcharts-figure">
                                        <div id="container4" style="height: 330px;"></div>
                                    </figure>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="box3">
                        <div class="box">
                            <div class="box-inside" style="height: 370px;">
                                <div class="box-head"><text>存股損益</text></div>
                                <div class="box-body">
                                    <figure class="highcharts-figure">
                                        <div id="container5" style="height: 330px;"></div>
                                    </figure>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box3">
                        <div class="box">
                            <div class="box-inside" style="height: 370px;">
                                <div class="box-head"><text>投股損益</text></div>
                                <div class="box-body">
                                    <figure class="highcharts-figure">
                                        <div id="container6" style="height: 330px;"></div>
                                    </figure>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box3">
                        <div class="box">
                            <div class="box-inside" style="height: 370px;">
                                <div class="box-head"><text>儲蓄使用占比</text></div>
                                <div class="box-body">
                                    <figure class="highcharts-figure">
                                        <div id="container3" style="height: 330px;"></div>
                                    </figure>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        	</div>
	       	<div th:replace="mobile/include/menu :: menu"/>
	   	</div>
	   	
	   	<script th:inline="javascript">
		   	setTimeout('showLoader()', 100);
	        function showLoader() {
	            $.mobile.loading("show",{
	                text: '', //載入器中顯示的文字  
	                textVisible: false, //是否顯示文字  
	                theme: 'a',        //載入器主題樣式a-e  
	                textonly: false,   //是否只顯示文字  
	                html: ""           //要顯示的html內容，如圖片等  
	            });
	        };
	        
		   	$(window).load(function() {
		   		var accountUserId = /*[[${accountUserId}]]*/ "";
		   		var accountId = /*[[${accountId}]]*/ "";
		   		var token = $("meta[name='_csrf']").attr("content");
	            $("#data").load("/home/asset/dashboard/investment/data", {"accountUserId":accountUserId, "accountId":accountId, "_csrf":token}, function(){
	                {
	                    var div = document.getElementById('deposit');
	                    var text = document.createElement('text');
	                    
	                    text.textContent = assetDetail[0].blance;
	                    div.appendChild(text);
	                }
	                
	                {
                        var div = document.getElementById('stock');
                        var text = document.createElement('text');
                        
                        text.textContent = stockInventory[stockInventory.length - 1].amount;
                        div.appendChild(text);
                    }
                    
                    {
                        var div = document.getElementById('totalAmount');
                        var text = document.createElement('text');
                        
                        text.textContent = totalAmount;
                        div.appendChild(text);
                    }
                    
                    {
                        var table = document.getElementById('assetDetail');
                        var tbody = document.createElement('tbody');

                        assetDetail.forEach(row => {
                            var tr = document.createElement('tr');
                            var td;

                            td = document.createElement('td');
                            td.textContent = row["recordDate"];
                            tr.appendChild(td);

                            td = document.createElement('td');
                            td.textContent = row["memo"];
                            tr.appendChild(td);
                            
                            td = document.createElement('td');
                            td.textContent = row["minus"];
                            td.className += "decimal minus";
                            tr.appendChild(td);

                            td = document.createElement('td');
                            td.textContent = row["plus"];
                            td.className += "decimal plus";
                            tr.appendChild(td);
                            
                            td = document.createElement('td');
                            td.textContent = row["blance"];
                            td.className += "decimal";
                            tr.appendChild(td);

                            tbody.appendChild(tr);
                        });

                        table.appendChild(tbody);
                    }
                    
                    {
                        var table = document.getElementById('stockInventory');
                        var tbody = document.createElement('tbody');

                        stockInventory.forEach(row => {
                            var tr = document.createElement('tr');
                            var td;

                            td = document.createElement('td');
                            td.textContent = row["stockId"];
                            tr.appendChild(td);

                            td = document.createElement('td');
                            td.textContent = row["stockName"];
                            tr.appendChild(td);

                            td = document.createElement('td');
                            td.textContent = row["quantity"];
                            td.className += "decimal";
                            tr.appendChild(td);
                            
                            td = document.createElement('td');
                            td.textContent = row["price"];
                            td.className += "decimal";
                            tr.appendChild(td);
                            
                            td = document.createElement('td');
                            td.textContent = row["amount"];
                            td.className += "decimal";
                            tr.appendChild(td);
                            
                            td = document.createElement('td');
                            td.textContent = row["cost"];
                            td.className += "decimal";
                            tr.appendChild(td);
                            
                            td = document.createElement('td');
                            td.textContent = row["profit"];
                            td.className += "decimal";
                            
                            if(Number(row["amount"].replace(",","")) > Number(row["cost"].replace(",",""))){
                                td.className += " plus";
                            }else if(Number(row["amount"].replace(",","")) < Number(row["cost"].replace(",",""))){
                                td.className += " minus";
                            }
                            
                            tr.appendChild(td);

                            tbody.appendChild(tr);
                        });

                        table.appendChild(tbody);
                    }
                    
                    Highcharts.setOptions({
                        lang: {
                            thousandsSep: ','   //千分位符號
                        }
                    });
                    
                    Highcharts.chart('container4', {
                        chart: {
                            type: 'area'
                        },
                        //accessibility: {
                        //    description: 'Image description: An area chart compares the nuclear stockpiles of the USA and the USSR/Russia between 1945 and 2017. The number of nuclear weapons is plotted on the Y-axis and the years on the X-axis. The chart is interactive, and the year-on-year stockpile levels can be traced for each country. The US has a stockpile of 6 nuclear weapons at the dawn of the nuclear age in 1945. This number has gradually increased to 369 by 1950 when the USSR enters the arms race with 6 weapons. At this point, the US starts to rapidly build its stockpile culminating in 32,040 warheads by 1966 compared to the USSR’s 7,089. From this peak in 1966, the US stockpile gradually decreases as the USSR’s stockpile expands. By 1978 the USSR has closed the nuclear gap at 25,393. The USSR stockpile continues to grow until it reaches a peak of 45,000 in 1986 compared to the US arsenal of 24,401. From 1986, the nuclear stockpiles of both countries start to fall. By 2000, the numbers have fallen to 10,577 and 21,000 for the US and Russia, respectively. The decreases continue until 2017 at which point the US holds 4,018 weapons compared to Russia’s 4,500.'
                        //},    //敘述
                        title: {
                            text: ''
                        },
                        //subtitle: {
                        //    text: 'Sources: <a href="https://thebulletin.org/2006/july/global-nuclear-stockpiles-1945-2006">' +
                        //        'thebulletin.org</a> &amp; <a href="https://www.armscontrol.org/factsheets/Nuclearweaponswhohaswhat">' +
                        //        'armscontrol.org</a>'
                        //},    //子標題
                        xAxis: {
                            allowDecimals: false,
                            title: {
                                text: '月份'   //X軸標題
                            },
                            labels: {
                                formatter: function () {
                                    return this.value; // clean, unformatted number for year
                                }
                            },
                            categories: months
                            //accessibility: {
                            //    rangeDescription: 'Range: 1940 to 2017.'  //X軸區間
                            //}
                        },
                        yAxis: {
                            title: {
                                text: '金額(萬)'   //Y軸標題
                            },
                            labels: {
                                formatter: function () {
                                    return this.value / 10000;
                                }
                            }
                        },
                        tooltip: {
                            //split: true,  //分點顯示
                            shared: true    //合併顯示
                            //valueDecimals: 2, //值顯示小數幾位
                            //valuePrefix: '$', //值前敘述
                            //valueSuffix: ' millions'    //值後敘述
                            //pointFormat: '{series.name} had stockpiled <b>{point.y:,.0f}</b><br/>warheads in {point.x}'   //顯示點資訊, 無法與shared同時顯示
                        },
                        plotOptions: {
                            area: {
                                //stacking: 'normal',   //堆疊
                                //pointStart: 1940, //起始點
                                //lineColor: '#666666',   //線顏色
                                //lineWidth: 1,   //線寬
                                marker: {
                                    //lineWidth: 1, //點邊寬
                                    //lineColor: '#666666', //點邊顏色

                                    enabled: false, //是否顯示點
                                    symbol: 'circle',   //圓點
                                    radius: 2,  //點大小
                                    states: {
                                        hover: {
                                            enabled: true
                                        }
                                    }
                                }
                            }
                        },
                        series: [
                            {
                                name: '存款',
                                data: deposits
                                //color: '#FFFF37'  //顏色
                            },
                            {
                                name: '股票',
                                data: totalStocks
                            },
                            {
                                type: 'spline',
                                name: '總合',
                                data: totals
                                //marker: {
                                //    lineWidth: 2,
                                //    lineColor: '#F7A059',
                                //    fillColor: 'white'
                                //}
                            },
                            {
                                type: 'spline',
                                name: '儲蓄',
                                data: saveMoneys
                            }
                        ]
                    });
                    
                    Highcharts.chart('container5', {
                        title: {
                            text: ''
                        },
                        xAxis: {
                            allowDecimals: false,
                            title: {
                                text: '月份'   //X軸標題
                            },
                            labels: {
                                formatter: function () {
                                    return this.value; // clean, unformatted number for year
                                }
                            },
                            categories: dates
                        },
                        yAxis: {
                            title: {
                                text: '金額(萬)'   //Y軸標題
                            },
                            labels: {
                                formatter: function () {
                                    return this.value / 10000;
                                }
                            }
                        },
                        tooltip: {
                            shared: true    //合併顯示
                        },
                        /*
                        legend: {
                            layout: 'vertical', //水平垂直
                            align: 'right', //位置
                            verticalAlign: 'middle'
                        },
                        */
                        series: [
                            {
                                name: '股票',
                                data: stockDailys[0].stock
                            },
                            {
                                name: '成本',
                                data: stockDailys[0].cost
                            }
                        ],
                        responsive: {
                            rules: [{
                                condition: {
                                    maxWidth: 500
                                },
                                chartOptions: {
                                    legend: {
                                        layout: 'horizontal',
                                        align: 'center',
                                        verticalAlign: 'bottom'
                                    }
                                }
                            }]
                        }
                    });
                    
                    Highcharts.chart('container6', {
                        title: {
                            text: ''
                        },
                        xAxis: {
                            allowDecimals: false,
                            title: {
                                text: '月份'   //X軸標題
                            },
                            labels: {
                                formatter: function () {
                                    return this.value; // clean, unformatted number for year
                                }
                            },
                            categories: dates
                        },
                        yAxis: {
                            title: {
                                text: '金額(萬)'   //Y軸標題
                            },
                            labels: {
                                formatter: function () {
                                    return this.value / 10000;
                                }
                            }
                        },
                        tooltip: {
                            shared: true    //合併顯示
                        },
                        /*
                        legend: {
                            layout: 'vertical',
                            align: 'right',
                            verticalAlign: 'middle'
                        },
                        */
                        series: [
                            {
                                name: '股票',
                                data: stockDailys[1].stock
                            },
                            {
                                name: '成本',
                                data: stockDailys[1].cost
                            }
                        ],
                        responsive: {
                            rules: [{
                                condition: {
                                    maxWidth: 500
                                },
                                chartOptions: {
                                    legend: {
                                        layout: 'horizontal',
                                        align: 'center',
                                        verticalAlign: 'bottom'
                                    }
                                }
                            }]
                        }
                    });
                                        
                    Highcharts.chart('container3', {
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false,
                            type: 'pie'
                        },
                        title: {
                            text: ''
                        },
                        subtitle: {
                            text: pieSubtitleText
                        },
                        tooltip: {
                            pointFormat: '{point.percentage:.1f}%'    //{series.name}名稱
                        },
                        accessibility: {
                            point: {
                                valueSuffix: '%'
                            }
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    //enabled: false,
                                    format: '<b>{point.name}</b>:<br/>{point.y:,f}<br/>{point.percentage:.1f} %'  //{point.name}名稱, {point.y}值, {point.percentage:.1f}百分比取小數一位
                                }
                                //showInLegend: true
                            }
                        },
                        series: [{
                            name: 'Brands',
                            colorByPoint: true,
                            data: pieData
                        }]
                    });
                    
                    $.mobile.loading('hide');
	            });
		   	});
	   	</script>
	</body>
</html>